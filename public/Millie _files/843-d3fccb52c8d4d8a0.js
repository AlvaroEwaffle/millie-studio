!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="503f869b-3a75-4bba-bbe3-7d07bb81e39c",e._sentryDebugIdIdentifier="sentry-dbid-503f869b-3a75-4bba-bbe3-7d07bb81e39c")}catch(e){}}();"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[843],{200843:function(e,t,r){r.d(t,{f:function(){return S},H:function(){return B}});var n=r(785893),a=r(786546),o=r(667294),c=r(242603),l=r(640051),u=r(730602),s=r(702203),i=r(234308),d=r(224437),p=r(683641),y=r(293978),m=r(885142),h=r(482747),f=r(578931),P=r(521667);r(919545);var A=r(380270),w=r(973314),g=r(400645),b=r(806483),_=r(883522);let S=(0,a.BX)(`
    fragment PaymentResult on Payment {
      id
      challenge {
        __typename
        ... on PaymentActionIDealRedirect {
          url
        }
        ...Adyen3DSChallenge
        ...Checkout3DSChallenge
      }
      result
    }
  `,[h.u$,h.p1]),v=a.BX.persisted("sha256:eb74a3137f8400d634c52b25fa1e8f89bd526f812e690e3ff513e2b4ea0e1406",(0,a.BX)(`
    mutation PaymentActionFinalise($id: ID!, $actionResult: PaymentActionResult!) {
      paymentActionFinalise(id: $id, actionResult: $actionResult) {
        _
      }
    }
  `));var C=r(268930),k=r(85723);let E=a.BX.persisted("sha256:4faa1d42e141d43d621f4fd6729575ce80d46d732a102d187c78805b2ed2a9c8",(0,a.BX)(`
    query SelectedPaymentMethods(
      $amount: Float
      $clientSupportsApplePay: Boolean!
      $countryCode: ID
      $locationSlug: String
      $previousSelections: [String!]!
      $scope: PaymentMethodsScope
      $macToken: String
      $selection: String!
    ) {
      selectedPaymentMethods(
        amount: $amount
        clientSupportsApplePay: $clientSupportsApplePay
        countryCode: $countryCode
        locationSlug: $locationSlug
        previousSelections: $previousSelections
        scope: $scope
        selection: $selection
        macToken: $macToken
      ) {
        edges {
          node {
            id
            category
            __typename
          }
        }
      }
    }
  `)),M={PaymentCardOnFile:"pay-with-card-on-file",PaymentApplePay:"pay-with-apple-pay",PaymentIDeal:"pay-with-ideal",PaymentFreshaAccount:"pay-with-fresha-account",PaymentProviderAccount:"pay-with-provider-account"},I=Object.values(M),D=e=>M[e],R=e=>Object.entries(M).find(t=>{let[r,n]=t;return n===e})?.[0],O=e=>({freshaAccount:e.find(e=>(0,k.T)(e))??null,providerAccount:e.find(e=>(0,f.CS)(e))??null,card:e.find(e=>"CARD"===e.category)??null}),$=e=>{let{amount:t,availablePaymentMethods:r,clientSupportStatus:n,getOutstandingBalance:a,isLoadingPaymentMethods:c,setOutstandingBalance:l,validateSelectedPaymentMethodsVariables:u}=e,s=(0,w.lr)(),i=s.toString(),y=(0,o.useRef)(s);y.current=s;let h=(0,b.N)(),{redirectTo:P}=(0,A.H)(),_=(0,C.H)(),S=(0,o.useRef)(u);S.current=u;let[v,$]=(0,o.useState)(!1),B=Object.values(n).every(e=>null!=e.isSupported),F=(0,o.useRef)(!1),U=(0,o.useCallback)(e=>e.filter(e=>{let[t]=e;return t.startsWith("pay-with-")}).map(e=>{let[t]=e;return R(t)}).filter(p.UP),[]),T=(0,o.useCallback)(e=>{let t=U(e);return O(B?r.filter(e=>t.includes(e.__typename)&&n[e.__typename]?.isSupported!==!1):[])},[r,B,n,U]),N=(0,o.useCallback)(e=>({...Object.fromEntries([...y.current.entries()].filter(e=>{let[t]=e;return!R(t)})),...e.freshaAccount&&{[D("PaymentFreshaAccount")]:"1"},...e.providerAccount&&{[D("PaymentProviderAccount")]:"1"},...e.card&&{[D(e.card.__typename)]:"1"}}),[i]),x=(0,o.useMemo)(()=>T([...y.current.entries()]),[T,i]),[j,q]=(0,o.useState)(()=>[x.card?.__typename,x.freshaAccount?.__typename,x.providerAccount?.__typename].filter(p.UP)),z=(0,o.useCallback)(e=>{q(n=>{let o="function"==typeof e?e(n):e;if(o.includes("PaymentApplePay")){let e=o.includes("PaymentFreshaAccount")?r.find(k.T):void 0,n=o.includes("PaymentProviderAccount")?r.find(f.CS):void 0,c=[e&&{freshaAccount:{id:e.id}},n&&{providerAccount:{providerId:n.providerAccount.providerId}}].filter(p.UP);(c.length?a(c):Promise.resolve(t)).then(e=>{l(e??t)}).catch(e=>{console.warn("Error refreshing outstanding balance for Apple Pay",e)})}return o})},[t,r,a,l]),X=(0,o.useMemo)(()=>{let e=j.find(e=>"PaymentFreshaAccount"!==e&&"PaymentProviderAccount"!==e);return{freshaAccount:j.includes("PaymentFreshaAccount")?r.find(e=>"PaymentFreshaAccount"===e.__typename)??null:null,providerAccount:j.includes("PaymentProviderAccount")?r.find(e=>"PaymentProviderAccount"===e.__typename)??null:null,card:e?r.find(t=>t.__typename===e)??null:null}},[r,j]),L=(0,o.useMemo)(()=>Object.values(r.reduce((e,t)=>{if(!t.autoSelection||n[t.__typename]?.isSupported===!1||"PaymentOneOffCard"===t.__typename)return e;let{group:r,priority:a}=t.autoSelection;return!e[r]||a<e[r].priority?{...e,[r]:{method:t,priority:a}}:e},{})).map(e=>e.method.__typename).sort(),[r,n]),J=(0,o.useRef)(L);(0,o.useEffect)(()=>{let e=U([...y.current.entries()]),t=L.length!==J.current.length||!L.every((e,t)=>e===J.current[t]);if(F.current&&L.length&&(!e.length||t)&&(F.current=!1,e.length||$(!1)),!B||F.current||c)return;let r=Object.fromEntries([...[...y.current.entries()].filter(e=>{let[t]=e;return!I.includes(t)}),...L.map(e=>[D(e),"1"])]);if(F.current=!0,J.current=L,z(L),!L.length){$(!0);return}P({hash:_,pathname:h,query:r})},[L,B,n,U,_,c,h,P,i]);let[H,W]=(0,o.useState)(!1),Z=(0,o.useRef)(!1),G=(0,o.useRef)(0);(0,o.useEffect)(()=>()=>window.clearTimeout(G.current),[]);let K=(0,o.useCallback)(e=>{if(Z.current)return;let t="function"==typeof e?e(X):e;P({hash:_,pathname:h,query:N({...X,...t})})},[N,_,h,P,X]),V=(0,o.useRef)(x),Q=(0,o.useCallback)(()=>{P({hash:_,pathname:h,query:{...Object.fromEntries([...y.current.entries()].filter(e=>{let[t]=e;return!R(t)})),...X.freshaAccount&&{[D("PaymentFreshaAccount")]:"1"},...X.providerAccount&&{[D("PaymentProviderAccount")]:"1"},...X.card&&{[D(X.card.__typename)]:"1"}}})},[_,h,P,i,X]),Y=(0,m.f)(async()=>{if(x.card?.__typename===X.card?.__typename&&x.freshaAccount?.__typename===X.freshaAccount?.__typename&&x.providerAccount?.__typename===X.providerAccount?.__typename){$(!0);return}Z.current=!0;let e=0;G.current=window.setTimeout(()=>{e=performance.now(),W(!0)},1e3);try{let e;if(x.card?.__typename!==X?.card?.__typename?e=x.card?.__typename??X?.card?.__typename:!!x.freshaAccount?.__typename!=!!X?.freshaAccount?.__typename?e="PaymentFreshaAccount":!!x.providerAccount?.__typename!=!!X?.providerAccount?.__typename&&(e="PaymentProviderAccount"),!e)return;let r={...S.current,amount:t,clientSupportsApplePay:!!n.PaymentApplePay?.isSupported,selection:e,previousSelections:[X.card?.__typename,X.freshaAccount?.__typename,X.providerAccount?.__typename].filter(p.UP)},a=await (0,g.B)(E,r);if(a.errors)throw a.errors;let o=a?.data?.selectedPaymentMethods?.edges.map(e=>e.node.__typename).filter(e=>"PaymentOneOffCard"!==e&&"PaymentGiftCard"!==e)??[],c=Object.fromEntries([...[...s.entries()].filter(e=>{let[t]=e;return!I.includes(t)}),...o.filter(e=>e in M).map(e=>D(e)).filter(p.UP).map(e=>[e,"1"])??[]]);z(o),P({hash:_,pathname:h,query:c})}catch(e){(0,d.tz)(e,{msg:"Unable to validate payment selections"}),Q()}finally{Z.current=!1,window.clearTimeout(G.current),G.current=window.setTimeout(()=>W(!1),Math.max(300,300-(performance.now()-e))),$(!0)}});return(0,o.useEffect)(()=>{!c&&(x.card||x.freshaAccount||x.providerAccount)&&x!==V.current&&(V.current=x,Y())},[c,x,Y]),{isDisabled:H,isReady:v&&!c,requestedPaymentMethods:x,selectedPaymentMethods:X,setSelectedPaymentMethods:K}};function B(e){let{amount:t,applePayLabel:r,children:C,countryCode:k,currency:E,getOutstandingBalance:M,isLoadingPaymentMethods:I,isPaid:D,initialisePayment:R,onPaid:O,paymentMethods:B,provider:F,subscription:U,subscriptionVariables:T,validateSelectedPaymentMethodsVariables:N}=e,x=function(){let{clearPaymentError:e,handlePaymentError:t,paymentError:r}=(0,l.x)(),a=r?(0,n.jsx)(c.Z,{error:r.message,errorAction:r.action,isWarningModalOpen:!0,onClose:()=>Promise.resolve(e())}):null;return{error:r,handlePaymentError:t,PaymentError:a}}(),{handlePaymentAction:j,hasCompletedPayment:q,hasMadePayment:z,PaymentChallenge:X,setHasCompletedPayment:L,setHasMadePayment:J}=function(e){let{handlePaymentError:t,provider:r,subscription:n}=e,{redirectTo:a}=(0,A.H)(),c=(0,b.N)(),l=(0,w.lr)(),u=l?.get("redirectResult"),i=l?.get("payment-id"),d=!!i,p=(0,o.useRef)(!1),m=(0,o.useCallback)((e,t)=>{let n=(()=>{switch(r){case s.h7.Adyen:{let{redirectResult:e}=t;return{adyen:{redirectResult:e}}}case s.h7.Checkout:throw Error("Payment redirect flow not supported in Checkout.com context");default:throw new y.S(r)}})();return(0,g.B)(v,{id:e,actionResult:n})},[r]),[h,f]=(0,o.useState)(d),[P,S]=(0,o.useState)(!1),{PaymentChallenge:C,startChallenge:k}=(0,_.e)(),E=(0,o.useCallback)(async e=>{switch(e.challenge?.__typename){case"PaymentActionIDealRedirect":e.challenge.url&&(window.location.href=e.challenge.url);break;case"PaymentActionAdyen3DSChallenge":case"PaymentActionCheckout3DSChallenge":await k(e.id,e.challenge);break;case void 0:case null:return;default:throw new y.S(e.challenge)}},[k]),M=(0,o.useCallback)(()=>{let e=new URLSearchParams(l);["redirectResult","payment-id"].forEach(t=>{e.delete(t)}),a({pathname:c,search:e.toString()})},[c,a,l]);return(0,o.useEffect)(()=>{i&&n&&!p.current&&(p.current=!0,M(),(async()=>{try{let e=await m(i,{redirectResult:u});if(e.errors?.length)throw e.errors;S(!0)}catch(e){f(!1),S(!1),t(e)}})())},[t,m,i,u,M,n]),{handlePaymentAction:E,hasCompletedPayment:P,hasMadePayment:h,PaymentChallenge:C,setHasCompletedPayment:S,setHasMadePayment:f}}({handlePaymentError:x.handlePaymentError,provider:F,subscription:U}),[H,W]=(0,o.useState)(t),{canInitiateApplePay:Z,hasInitiated:G,isLoading:K,payWithApplePay:V,canUseApplePay:Q}=(0,P.MB)({amount:H,applePayLabel:r,countryCode:k,currency:E,paymentMethods:B}),Y=(0,o.useMemo)(()=>B?.map(e=>a.vz(h.eM,e)).filter(p.AK).filter(e=>"PaymentGiftCard"!==e.__typename)??[],[B]),ee=(0,o.useMemo)(()=>({PaymentApplePay:{isSupported:Z&&!G||K?null:Q}}),[Z,Q,G,K]),et=(0,o.useMemo)(()=>Y.filter(e=>void 0===ee[e.__typename]||ee[e.__typename]?.isSupported),[Y,ee]),{isDisabled:er,isReady:en,requestedPaymentMethods:ea,selectedPaymentMethods:eo,setSelectedPaymentMethods:ec}=$({amount:t,clientSupportStatus:ee,getOutstandingBalance:M,isLoadingPaymentMethods:I||Object.values(ee).some(e=>null===e),availablePaymentMethods:Y,setOutstandingBalance:W,validateSelectedPaymentMethodsVariables:N}),el=I||!en,eu=!el&&!z&&(!!eo.card||function(e,t){let r=e.reduce((e,t)=>{switch(t?.__typename){case"PaymentFreshaAccount":return e+(0,a.vz)(h.cr,t).freshaAccount.balance.amount.value;case"PaymentProviderAccount":return e+(a.vz(h.t2,t).providerAccount.balance?.[0]?.amount.value??0);default:return e}},0);return e.filter(Boolean).length>0&&r>=t}([eo.freshaAccount,eo.providerAccount],t)),{getPaymentInputs:es,getSelectedPaymentMethods:ei,initialisePayments:ed}=function(e){let{handlePaymentAction:t,initialisePayment:r,provider:n,readyPaymentMethods:c,selectedPaymentMethods:l}=e,u=(0,o.useCallback)(()=>{let e=[];switch(l.freshaAccount&&e.push({paymentMethod:"PaymentFreshaAccount"}),l.providerAccount&&e.push({paymentMethod:"PaymentProviderAccount"}),l.card?.__typename){case"PaymentApplePay":e.push({paymentMethod:"PaymentApplePay"});break;case"PaymentCardOnFile":e.push({paymentMethod:"PaymentCardOnFile"});break;case"PaymentIDeal":e.push({paymentMethod:"PaymentIDeal"});break;case null:case void 0:break;default:throw new y.S(l.card)}return e},[l]);return{getPaymentInputs:(0,o.useCallback)(e=>{let{optionsApplePay:t,selectedMethods:r}=e,a=e=>{let{options:r,paymentMethod:a,readyPaymentMethod:o}=e;switch(a){case"PaymentOneOffCard":return{paymentMethod:s.vI.OneOffCard,oneOffCard:{...n===s.h7.Adyen&&{adyen:{...r,browserInfo:(0,f.S7)()}},...n===s.h7.Checkout&&{checkout:r}}};case"PaymentApplePay":if(!t)throw Error("Cannot pay using Apple Pay without an initialised Apple Pay token");return{paymentMethod:s.vI.ApplePay,applePay:t};case"PaymentIDeal":{let e=new URL(window.location.toString());return e.hash="",{paymentMethod:s.vI.Ideal,ideal:{returnUrl:e.toString()}}}case"PaymentCardOnFile":return{paymentMethod:s.vI.CardOnFile,cardOnFile:{...n===s.h7.Adyen&&{adyen:{browserInfo:(0,f.S7)()}},...n===s.h7.Checkout&&{checkout:{}}}};case"PaymentFreshaAccount":return{paymentMethod:s.vI.FreshaAccount,freshaAccount:{id:o?.id??""}};case"PaymentProviderAccount":return{paymentMethod:s.vI.ProviderAccount,providerAccount:{providerId:o.providerAccount.providerId}};default:throw new y.S(a)}},o=r.map(e=>{let t=c.find(t=>t.__typename===e.paymentMethod);if(!t)throw Error(`Cannot pay using disallowed payment method ${e.paymentMethod}`);return{...e,readyPaymentMethod:t}});if(!o.length)throw Error("Cannot make payment without at least one selected payment method");return o.map(e=>a(e)).filter(p.AK)},[n,c]),getSelectedPaymentMethods:u,initialisePayments:async(e,n)=>{let o=await r({payments:e});if(!o){n.current=!0;return}let c=o.errors?.slice().sort((e,t)=>!e.extensions?.formattedMessage&&t.extensions?.formattedMessage?1:e.extensions?.formattedMessage&&!t.extensions?.formattedMessage?-1:0)[0];if(c)throw c;let l=(0,a.vz)(S,o.data);if(l)switch(l.result){case"REQUIRES_ACTION":await t(l);break;case"SUCCEEDED":break;default:throw Error("Unsuccessful payment status")}}}}({handlePaymentAction:j,initialisePayment:R,provider:F,readyPaymentMethods:et,selectedPaymentMethods:eo}),ep=(0,m.f)(async e=>{let r=e?.methods??ei();try{J(!0);let e={current:!1};if(r.some(e=>"PaymentApplePay"===e.paymentMethod)){let n=r.some(e=>et.find(t=>t.__typename===e.paymentMethod)?.category!=="CARD")?await M(es({selectedMethods:r.filter(e=>et.find(t=>t.__typename===e.paymentMethod)?.category!=="CARD")}).map(e=>{switch(e.paymentMethod){case s.vI.ProviderAccount:return{providerAccount:{providerId:e.providerAccount.providerId}};case s.vI.FreshaAccount:return{freshaAccount:{id:e.freshaAccount.id}};default:throw Error(`Unsupported excluded payment method ${e.paymentMethod}`)}}))??t:t;await V(async t=>{let n=btoa(JSON.stringify(t.details.token.paymentData)),a=(()=>{switch(F){case s.h7.Adyen:return{adyen:{applePayToken:n,browserInfo:(0,f.S7)()}};case s.h7.Checkout:return{checkout:{applePayToken:n,displayName:t.details.token.paymentMethod?.displayName}};default:throw new y.S(F)}})(),o=es({optionsApplePay:a,selectedMethods:r});await ed(o,e)},{amount:n})}else{let t=es({selectedMethods:r});await ed(t,e)}if(e.current){J(!1);return}L(!0)}catch(e){J(!1),e instanceof P.Td?((0,d.tz)(e.originalError,{msg:"Apple Pay payment aborted"}),x.handlePaymentError([{extensions:{formattedMessage:(0,i.__)`Payment cancelled. Please try again.`}}])):e instanceof P.O9?((0,d.tz)(e.originalError,{msg:"Unable to show Apple Pay payment"}),x.handlePaymentError(e.originalError)):e instanceof P.Jc?((0,d.tz)(e.originalError,{msg:"Unable to complete Apple Pay payment"}),x.handlePaymentError(e.originalError)):((0,d.tz)(e,{msg:"Payment failed",paymentMethods:r.map(e=>e.paymentMethod)}),x.handlePaymentError(e))}}),ey=(0,o.useRef)(!1),em=(0,o.useRef)(void 0),eh=(0,m.f)(e=>{let{data:t,error:r}=e;r!==em.current&&r?.length?(em.current=r,x.handlePaymentError(r[0]),L(!1),J(!1),ey.current=!1):!ey.current&&t&&D(t)&&(ey.current=!0,O())}),ef=(0,u.pM)(q?U:null,T);return(0,o.useEffect)(()=>{eh({data:ef.data,error:ef.error})},[eh,ef.data,ef.error]),(0,n.jsxs)(n.Fragment,{children:[C({canMakePayment:eu,handleError:x.handlePaymentError,hasMadePayment:z,isLoading:el,isPaymentSelectionDisabled:er,makePayment:ep,paymentMethods:et,requestedPaymentMethods:ea,selectedPaymentMethods:eo,setSelectedPaymentMethods:ec}),X,x.PaymentError]})}},919545:function(e,t,r){r.d(t,{W:function(){return a},Z:function(){return o}});var n=r(786546);let a=n.BX.persisted("sha256:b1c917b13a00138982b5e4ca82d63210288ae9c80fbcfead8b66617ef284d515",(0,n.BX)(`
    mutation CreateApplePaySessionByLocation($slug: String!) {
      createApplePaySessionByLocation(slug: $slug) {
        token
      }
    }
  `)),o=n.BX.persisted("sha256:22a42ab160281f82fd0d6216c5fea5704e12f1be648af58e5f4bd3ce4f587bfe",(0,n.BX)(`
    mutation CreateApplePaySessionByLocationId($id: ID!) {
      createApplePaySessionByLocationId(locationId: $id) {
        token
      }
    }
  `))},521667:function(e,t,r){r.d(t,{Jc:function(){return h},MB:function(){return f},O9:function(){return m},Td:function(){return y},ZJ:function(){return u},cg:function(){return s},yd:function(){return i}});var n=r(786546),a=r(667294),o=r(730602),c=r(224437),l=r(482747);let u=n.BX.persisted("sha256:4620164be19f7d407d4022b17b4e7803a2d631280db141378857a430a60d79f4",(0,n.BX)(`
    mutation CreateApplePaySession($countryCode: ID!) {
      createApplePaySessionByCountry(countryCode: $countryCode) {
        token
      }
    }
  `)),s={SUPPORTS_3DS:"supports3DS",SUPPORTS_CREDIT:"supportsCredit",SUPPORTS_DEBIT:"supportsDebit",SUPPORTS_EMV:"supportsEMV"},i=e=>e?.__typename==="PaymentApplePay",d=e=>{let{applePayLabel:t,applePayPaymentMethod:r,countryCode:n,currency:o}=e,c=!!n&&!!o&&!!t&&!!r;return{applePayData:(0,a.useMemo)(()=>{if(c)return{countryCode:n,currency:o,merchantIdentifier:r.webMerchantId||"",merchantName:r.merchantName||"",supportedNetworks:r.supportedNetworks||[],webMerchantCapabilities:r.webMerchantCapabilities||[]}},[r,n,o,c]),canInitiateApplePay:c}},p=e=>{let{countryCode:t}=e,{trigger:r}=(0,o.pk)(u);return{createApplePaySession:(0,a.useCallback)(async()=>{let{errors:e,result:n}=await r({countryCode:t});if(e?.length)throw e.length>1?e:e[0];return JSON.parse(n.createApplePaySessionByCountry.token)},[t,r])}};class y extends Error{constructor(e){super(),this.originalError=e}}class m extends Error{constructor(e){super(),this.originalError=e}}class h extends Error{constructor(e){super(),this.originalError=e}}let f=e=>{let{amount:t,applePayLabel:r,countryCode:o,currency:u,paymentMethods:f}=e,[P,A]=(0,a.useState)(null),[w,g]=(0,a.useState)(!1),{createApplePaySession:b}=p({countryCode:o}),{applePayData:_,canInitiateApplePay:S}=d({applePayLabel:r,applePayPaymentMethod:f?.map(e=>n.vz(l.eM,e)).find(i),countryCode:o,currency:u});(0,a.useEffect)(()=>{let e=String(t||1);if(S&&_){if(!window.PaymentRequest||!_.webMerchantCapabilities.length){g(!0);return}if(!P||t&&P.details.total.amount.value!==e)try{let t=_.webMerchantCapabilities.map(e=>s[e]),n=[{supportedMethods:"https://apple.com/apple-pay",data:{version:3,countryCode:_.countryCode,merchantCapabilities:t,merchantIdentifier:_.merchantIdentifier,merchantName:_.merchantName,supportedNetworks:_.supportedNetworks}}],a={total:{label:r,amount:{value:e,currency:_.currency}}},o=new PaymentRequest(n,a,{requestPayerName:!1,requestBillingAddress:!1,requestPayerEmail:!1,requestPayerPhone:!1,requestShipping:!1,shippingType:"pickup"});o.onmerchantvalidation=e=>{e.complete(b().catch(e=>{(0,c.tz)(e,{msg:"Unable to create Apple Pay session"})}))},o.details=a,A(o)}catch(e){(0,c.tz)(e,{msg:"Unable to create PaymentRequest"}),g(!0)}}},[t,r,S,b,_,P]);let[v,C]=(0,a.useState)(!1),[k,E]=(0,a.useState)(!1);return(0,a.useEffect)(()=>{if(v){g(!0);return}P&&(async()=>{try{E(!0);let e=await P.canMakePayment();C(e)}catch(e){(0,c.tz)(e,{msg:"Error calling canMakePayment on PaymentRequest API"}),C(!1)}finally{E(!1),g(!0)}})()},[v,P]),{canInitiateApplePay:S,canUseApplePay:v,hasInitiated:w,isLoading:k,payWithApplePay:(0,a.useCallback)(async(e,t)=>{let n;try{n=await P.show(t?Promise.resolve({total:{label:r,amount:{value:String(t.amount),currency:_?.currency||""}}}):void 0)}catch(e){if("AbortError"===e.name)throw A(null),new y(e);throw new m(e)}try{await e(n),await n.complete("success")}catch(e){throw await n.complete("fail"),new h(e)}},[r,P,_?.currency])}}},883522:function(e,t,r){r.d(t,{e:function(){return y}});var n=r(785893),a=r(667294),o=r(293978),c=r(69209),l=r(400645),u=r(786546);let s=u.BX.persisted("sha256:302db6d1d9f67d89e92e290275942b1cbc074246028fff9057e5ef1cf7a7016c",(0,u.BX)(`
    mutation Complete3DSChallenge($id: ID!, $input: Complete3DSChallengeInput!) {
      complete3DSChallenge(id: $id, input: $input) {
        result
      }
    }
  `)),i=e=>{let t=e.data?.__typename==="PaymentActionAdyen3DSChallenge"?e.data:void 0,{onSuccess:r,onFail:o,paymentId:u}=e,i=(0,a.useCallback)((e,t)=>(0,l.B)(s,{id:e,input:{adyen:{redirectResult:t}}}),[]),d=(0,a.useCallback)(async e=>{try{let t=await i(u,e.data.request?.redirectResult||"");if(t.data?.complete3DSChallenge?.result==="SUCCEEDED"){r();return}if(t.data?.complete3DSChallenge?.result==="FAILED")throw Error("3DS-challenge-failed");if(t.errors)throw Error(t.errors[0].message);throw Error("Unhandled 3DS challenge result")}catch(e){o(e)}},[u,r,o,i]),p=(0,a.useCallback)(async e=>{await i(u,""),o(e)},[i,u,o]);if(!t||!("md"in t))throw Error("Invalid challenge data for Adyen 3DS");return(0,n.jsx)(c.a,{handleClose:p,redirectUrl:t.urlToIssuer,handleIframeMessage:d,scaDetails:{MD:t.md,PaReq:t.paReq,TermUrl:t.urlToMerchant}})};var d=r(142028);let p=e=>{let t=e.data?.__typename==="PaymentActionCheckout3DSChallenge"?e.data:void 0,r=t.paymentDataId,{onSuccess:o,onFail:c,paymentId:u}=e,i=(0,a.useCallback)((e,t,r)=>(0,l.B)(s,{id:e,input:{checkout:{redirectResult:t,paymentDataId:r}}}),[]),p=(0,a.useCallback)(async e=>{try{await i(u,e,r).then(e=>{if(e.errors)throw Error(e.errors[0].message);o()})}catch(e){c(e)}},[u,o,c,i,r]),y=(0,a.useCallback)(async()=>{await i(u,"",r),c(Error("3DS-Checkout could not be completed"))},[c,i,u,r]);if(!t||!("paymentDataId"in t))throw Error("Invalid challenge data for checkout 3DS");return(0,n.jsx)(d.Z,{onFail:y,closeModal:()=>Promise.resolve(),url:t.url,onSuccess:p})},y=()=>{let[e,t]=(0,a.useState)(!1),r=(0,a.useRef)(null),c=(0,a.useRef)(null),l=(0,a.useRef)(null),u=(0,a.useCallback)(()=>{t(!1),l.current?.resolve()},[]),s=(0,a.useCallback)(e=>{t(!1),l.current?.reject(e)},[]),d=(0,a.useCallback)((e,n)=>(r.current=n,c.current=e,t(!0),new Promise((e,t)=>{l.current={resolve:e,reject:t}})),[]);return(0,a.useMemo)(()=>{let t=function(e){switch(e){case"PaymentActionAdyen3DSChallenge":return i;case"PaymentActionCheckout3DSChallenge":return p;case null:case void 0:return null;default:throw new o.S(e)}}(r.current?.__typename);return{PaymentChallenge:e&&t?(0,n.jsx)(t,{data:r.current,paymentId:c.current,onSuccess:u,onFail:s}):null,startChallenge:d}},[d,e,u,s])}}}]);
//# sourceMappingURL=843-d3fccb52c8d4d8a0.js.map